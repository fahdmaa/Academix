<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check Form Submissions - OUIIPROF</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .submission { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0; }
        .submission-header { font-weight: bold; color: #495057; border-bottom: 1px solid #dee2e6; padding-bottom: 5px; margin-bottom: 10px; }
        .field { margin: 5px 0; }
        .field strong { color: #6c757d; }
        .no-submissions { text-align: center; color: #6c757d; padding: 40px; background: #f8f9fa; border-radius: 8px; }
        .clear-btn { background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 10px 0; }
        .clear-btn:hover { background: #c82333; }
        .export-btn { background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 10px 5px; }
        .export-btn:hover { background: #218838; }
    </style>
</head>
<body>
    <h1>üìß Form Submissions Checker</h1>
    <p>This page shows all form submissions saved in browser localStorage.</p>
    
    <div>
        <button class="export-btn" onclick="exportSubmissions()">üì• Export as JSON</button>
        <button class="export-btn" onclick="exportSubmissionsCSV()">üìä Export as CSV</button>
        <button class="clear-btn" onclick="clearSubmissions()">üóëÔ∏è Clear All Submissions</button>
    </div>
    
    <div id="submissions-container">
        <div class="no-submissions">Loading submissions...</div>
    </div>

    <script>
        function loadSubmissions() {
            const container = document.getElementById('submissions-container');
            
            try {
                const submissions = JSON.parse(localStorage.getItem('ouiiprof_submissions') || '[]');
                
                if (submissions.length === 0) {
                    container.innerHTML = '<div class="no-submissions">No form submissions found in localStorage.</div>';
                    return;
                }
                
                let html = `<h2>üì¨ Found ${submissions.length} submission(s):</h2>`;
                
                submissions.forEach((submission, index) => {
                    html += `
                        <div class="submission">
                            <div class="submission-header">Submission #${index + 1} - ${new Date(submission.timestamp).toLocaleString()}</div>
                            <div class="field"><strong>Name:</strong> ${submission.name || submission.firstName + ' ' + submission.lastName || 'N/A'}</div>
                            <div class="field"><strong>Email:</strong> ${submission.email || 'N/A'}</div>
                            <div class="field"><strong>Subject:</strong> ${submission.subject || 'N/A'}</div>
                            <div class="field"><strong>Message:</strong> ${submission.message || 'N/A'}</div>
                            <div class="field"><strong>Language:</strong> ${submission.language || 'N/A'}</div>
                            <div class="field"><strong>Submission ID:</strong> ${submission.submissionId || 'N/A'}</div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
            } catch (error) {
                container.innerHTML = `<div class="no-submissions">Error loading submissions: ${error.message}</div>`;
            }
        }
        
        function clearSubmissions() {
            if (confirm('Are you sure you want to clear all saved form submissions?')) {
                localStorage.removeItem('ouiiprof_submissions');
                loadSubmissions();
                alert('All submissions cleared!');
            }
        }
        
        function exportSubmissions() {
            const submissions = JSON.parse(localStorage.getItem('ouiiprof_submissions') || '[]');
            const dataStr = JSON.stringify(submissions, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `ouiiprof_submissions_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }
        
        function exportSubmissionsCSV() {
            const submissions = JSON.parse(localStorage.getItem('ouiiprof_submissions') || '[]');
            
            if (submissions.length === 0) {
                alert('No submissions to export');
                return;
            }
            
            const headers = ['Name', 'Email', 'Subject', 'Message', 'Language', 'Timestamp', 'Submission ID'];
            const csvContent = [
                headers.join(','),
                ...submissions.map(sub => [
                    `"${(sub.name || sub.firstName + ' ' + sub.lastName || '').replace(/"/g, '""')}"`,
                    `"${(sub.email || '').replace(/"/g, '""')}"`,
                    `"${(sub.subject || '').replace(/"/g, '""')}"`,
                    `"${(sub.message || '').replace(/"/g, '""')}"`,
                    sub.language || '',
                    sub.timestamp || '',
                    sub.submissionId || ''
                ].join(','))
            ].join('\n');
            
            const dataBlob = new Blob([csvContent], {type: 'text/csv'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `ouiiprof_submissions_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }
        
        // Load submissions on page load
        loadSubmissions();
        
        // Auto-refresh every 30 seconds
        setInterval(loadSubmissions, 30000);
    </script>
</body>
</html>